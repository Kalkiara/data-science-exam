---
title: "datasci_exam"
output: html_document
date: "2023-04-24"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
pacman::p_load(tidyverse,tsibble, ggfortify, feasts, ggplot2)
```


# loading data and cleaning

```{r}
data_path <- "../data/top_songs_by_month.csv"

df <- read_csv(data_path)



df_ts <- as_tsibble(df, key = song_name, index = date)
```

```{r}
ggplot(df, aes(date, danceability)) +
  geom_smooth()

ggplot(df, aes(date, energy)) +
  geom_smooth()

ggplot(df, aes(date, acousticness)) +
  geom_smooth()


ggplot(df, aes(date, instrumentalness)) +
  geom_smooth()
```

```{r}
df_agg <- df %>% 
  group_by(date) %>% 
  mutate(loud_normal = loudness / 10) %>% 
  summarize(dance_mean = mean(danceability),
            energy_mean = mean(energy),
            loudness_mean = mean(loud_normal),
            speechiness_mean = mean(speechiness),
            acousticness_mean = mean(acousticness),
            instrumentalness_mean = mean(instrumentalness),
            liveness_mean = mean(liveness),
            valence_mean = mean(liveness)) 

df_agg_long <- df_agg %>% 
  pivot_longer(., -c('date'))

df_agg_ts <- ts(data.matrix(df_agg),  start = c(1960, 1), frequency = 12)

p1 <- autoplot(df_agg_ts, geom = "ribbon")+
  theme_minimal()
p1

df_agg_long %>% 
  ggplot(aes(x = date, y = value, fill = name))+
  geom_line()+
  facet_grid(~name)
```

```{r}
df_ts_agg <- as_tsibble(df_agg)

df_ts_agg %>% 
  gg_lag(month_mean, geom = "point", lag = c(12, 24, 36, 120, 240, 360))


```
```{r}
df_ts_agg %>% 
  ACF(month_mean, lag_max = 720) %>% autoplot()

df_ts_agg %>% 
  ACF(month_mean, lag_max = 12) %>% autoplot()
```

